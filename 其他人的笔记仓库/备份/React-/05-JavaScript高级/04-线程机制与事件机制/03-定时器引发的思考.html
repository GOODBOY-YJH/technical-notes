<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>03_定时器引发的思考</title>
	</head>

	<body>
		<!--
1. 定时器真是定时执行的吗?
  * 定时器并不能保证真正定时执行
  * 一般会延迟一丁点(可以接受), 也有可能延迟很长时间(不能接受)
2. 定时器回调函数是在分线程执行的吗?
  * 在主线程执行的, js是单线程的
3. 定时器是如何实现的?
  * 事件循环模型(后面讲)
-->
		<script type="text/javascript">
			console.log('程序开始执行')

			var time = Date.now()
			setTimeout(function () {
				console.log('定时器耗费时间:', Date.now() - time)
			}, 500)

			for (var i = 0; i < 10000; i++) {
				console.log(i)
			}

			// 输出后发现定时器耗费的时间不止500毫秒 ---> 到事件轮询机制
			// JS所有的代码都会在JS的主线程上执行
			// 当主线程开启异步时，会将其交给相应的管理模块去管理，即将定时器交给定时器管理模块
			// 主线程继续执行后面的任务，即for循环
			// 管理模块接管的对应的回调，会在符合条件时(即到达定时器设定的时间)将对应的回调放入回调队列中
			// 当主线程上所有同步任务执行完成时，会通过“轮询”的方式去询问回调队列是否有可执行的回调
			// 如果有就将相应的回调勾到主线程上执行，如果没有就反复询问
			// 误差就产生于等待主线程上所有任务执行完成后再询问回调队列

			// 在定时器前面放for不影响

			// 故在实际开发中不要在定时器后放置运算量大的代码段
		</script>
	</body>
</html>
